{{ define "main" }}
<div style="max-width: 64rem; margin: 0 auto; padding: 1rem;">
  <section style="padding: 0 1rem;">
    
    <!-- Category Filter Section -->
    <div id="category-filter-section" style="margin-bottom: 1.5rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
      <h3 style="margin: 0 0 1rem 0; color: #333; font-size: 1.1rem;">Filter by News Category:</h3>

      <div id="category-buttons" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
        <button onclick="filterPosts('all', 'category')" class="category-filter active" data-category="all"
                style="padding: 0.5rem 1rem; border: 1px solid #0066cc; background: #0066cc; color: white; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s;">
          All Categories
        </button>

        {{ $allCategories := slice }}
        {{ range .Pages }}
          {{ if .Params.category }}
            {{ $allCategories = $allCategories | append .Params.category }}
          {{ end }}
        {{ end }}
        {{ $uniqueCategories := $allCategories | uniq | sort }}

        {{ range $uniqueCategories }}
        <button onclick="filterPosts('{{ . }}', 'category')" class="category-filter" data-category="{{ . }}"
                style="padding: 0.5rem 1rem; border: 1px solid #0066cc; background: white; color: #0066cc; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s;">
          {{ . }}
        </button>
        {{ end }}
      </div>
    </div>

    <!-- Company Type Filter Section -->
    <div id="company-type-filter-section" style="margin-bottom: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
      <h3 style="margin: 0 0 1rem 0; color: #333; font-size: 1.1rem;">Filter by Company Type:</h3>

      <div id="company-type-buttons" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
        <button onclick="filterPosts('all', 'company_type')" class="company-type-filter active" data-company_type="all"
                style="padding: 0.5rem 1rem; border: 1px solid #cc6600; background: #cc6600; color: white; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s;">
          All Types
        </button>

        {{ $allCompanyTypes := slice }}
        {{ range .Pages }}
          {{ if .Params.company_type }}
            {{ $allCompanyTypes = $allCompanyTypes | append .Params.company_type }}
          {{ end }}
        {{ end }}
        {{ $uniqueCompanyTypes := $allCompanyTypes | uniq | sort }}

        {{ range $uniqueCompanyTypes }}
        <button onclick="filterPosts('{{ . }}', 'company_type')" class="company-type-filter" data-company_type="{{ . }}"
                style="padding: 0.5rem 1rem; border: 1px solid #cc6600; background: white; color: #cc6600; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s;">
          {{ . }}
        </button>
        {{ end }}
      </div>

      <div id="active-filters" style="font-size: 0.9rem; color: #666; margin-top: 1rem;">
        Showing: <span id="filter-status">All posts</span>
      </div>
    </div>

    <!-- Posts Counter -->
    <div id="posts-counter" style="margin-bottom: 1.5rem; padding: 0.5rem 0; color: #666; font-size: 0.95rem; border-bottom: 1px solid #eee;">
      <span id="visible-count">{{ len .Pages }}</span> of {{ len .Pages }} posts
    </div>

    <!-- News List -->
    <div class="news-list" id="news-list">
      {{ range .Pages.ByDate.Reverse }}
      <article class="news-post" data-tags="{{ delimit .Params.tags "," }}" data-category="{{ .Params.category }}" data-company_type="{{ .Params.company_type }}"
               style="border-bottom: 1px solid #eee; padding-bottom: 2rem; margin-bottom: 2rem; transition: all 0.3s;">
        <header style="margin-bottom: 1rem;">
          <h2 style="font-size: 1.5rem; color: #333; line-height: 1.3; margin-bottom: 0.5rem;">
            <a href="{{ .Permalink }}" style="color: inherit; text-decoration: none;">{{ .Title }}</a>
          </h2>
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
            <time datetime="{{ .Date.Format "2006-01-02" }}" style="font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; color: #666;">
              {{ .Date.Format "January 2, 2006" }}
            </time>
            {{ if .Params.tags }}
            <div class="post-tags" style="display: flex; gap: 0.3rem; flex-wrap: wrap;">
              {{ range .Params.tags }}
              <span class="post-tag" style="background: #e3f2fd; color: #1976d2; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">
                {{ . | title }}
              </span>
              {{ end }}
            </div>
            {{ end }}
          </div>
        </header>
        
        {{ if .Params.featured_image }}
        <div style="margin-bottom: 1rem;">
          <img src="{{ .Params.featured_image }}" alt="{{ .Title }}" style="width: 100%; height: auto; border-radius: 8px;">
        </div>
        {{ end }}
        
        <div style="font-size: 1.125rem; line-height: 1.6; margin-bottom: 1rem; max-width: 48rem;">
          {{ .Summary }}
        </div>
        
        <a href="{{ .Permalink }}" style="border: 1px solid #ccc; background-color: #f7f7f7; border-radius: 4px; color: inherit; display: inline-block; font-size: 0.875rem; text-decoration: none; margin-top: 0.5rem; padding: 0.5rem 1rem;">
          Read more â†’
        </a>
      </article>
      {{ end }}
    </div>

    <!-- No Results Message -->
    <div id="no-results" style="display: none; text-align: center; padding: 3rem 0; color: #666; font-style: italic;">
      <h3 style="margin-bottom: 1rem;">No posts found</h3>
      <p>Try selecting different tags or view all posts.</p>
    </div>

  </section>
</div>

<script>
let currentCategoryFilter = 'all';
let currentCompanyTypeFilter = 'all';

function filterPosts(value, filterType) {
  // Update filter state
  if (filterType === 'category') {
    currentCategoryFilter = value;
  } else if (filterType === 'company_type') {
    currentCompanyTypeFilter = value;
  }

  const posts = document.querySelectorAll('.news-post');
  const noResults = document.getElementById('no-results');
  const filterStatus = document.getElementById('filter-status');
  const visibleCount = document.getElementById('visible-count');
  let visiblePosts = 0;

  // Update active buttons for categories
  document.querySelectorAll('.category-filter').forEach(btn => {
    btn.classList.remove('active');
    btn.style.background = 'white';
    btn.style.color = '#0066cc';
  });

  const activeCategoryBtn = document.querySelector(`[data-category="${currentCategoryFilter}"]`);
  if (activeCategoryBtn) {
    activeCategoryBtn.classList.add('active');
    activeCategoryBtn.style.background = '#0066cc';
    activeCategoryBtn.style.color = 'white';
  }

  // Update active buttons for company types
  document.querySelectorAll('.company-type-filter').forEach(btn => {
    btn.classList.remove('active');
    btn.style.background = 'white';
    btn.style.color = '#cc6600';
  });

  const activeCompanyTypeBtn = document.querySelector(`[data-company_type="${currentCompanyTypeFilter}"]`);
  if (activeCompanyTypeBtn) {
    activeCompanyTypeBtn.classList.add('active');
    activeCompanyTypeBtn.style.background = '#cc6600';
    activeCompanyTypeBtn.style.color = 'white';
  }

  // Filter posts with AND logic - must match BOTH category and company_type
  posts.forEach(post => {
    const postCategory = post.getAttribute('data-category');
    const postCompanyType = post.getAttribute('data-company_type');

    const categoryMatches = currentCategoryFilter === 'all' || postCategory === currentCategoryFilter;
    const companyTypeMatches = currentCompanyTypeFilter === 'all' || postCompanyType === currentCompanyTypeFilter;

    const shouldShow = categoryMatches && companyTypeMatches;

    if (shouldShow) {
      post.style.display = 'block';
      post.style.opacity = '1';
      visiblePosts++;
    } else {
      post.style.display = 'none';
      post.style.opacity = '0';
    }
  });

  // Update counter and status
  visibleCount.textContent = visiblePosts;

  let statusText = [];
  if (currentCategoryFilter !== 'all') {
    statusText.push(`Category: "${currentCategoryFilter}"`);
  }
  if (currentCompanyTypeFilter !== 'all') {
    statusText.push(`Type: "${currentCompanyTypeFilter}"`);
  }

  if (statusText.length === 0) {
    filterStatus.textContent = 'All posts';
  } else {
    filterStatus.textContent = statusText.join(' + ');
  }

  // Show/hide no results message
  if (visiblePosts === 0) {
    noResults.style.display = 'block';
  } else {
    noResults.style.display = 'none';
  }
}

// Add hover effects to buttons
document.addEventListener('DOMContentLoaded', function() {
  const categoryButtons = document.querySelectorAll('.category-filter');
  const companyTypeButtons = document.querySelectorAll('.company-type-filter');

  [categoryButtons, companyTypeButtons].forEach(buttonGroup => {
    buttonGroup.forEach(btn => {
      btn.addEventListener('mouseenter', function() {
        if (!this.classList.contains('active')) {
          this.style.opacity = '0.8';
        }
      });

      btn.addEventListener('mouseleave', function() {
        if (!this.classList.contains('active')) {
          this.style.opacity = '1';
        }
      });
    });
  });
});
</script>

<style>
.category-filter, .company-type-filter {
  transition: all 0.2s ease;
}

.category-filter:hover, .company-type-filter:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.category-filter.active {
  background: #0066cc !important;
  color: white !important;
}

.company-type-filter.active {
  background: #cc6600 !important;
  color: white !important;
}

.news-post {
  transition: all 0.3s ease;
}

.post-tag {
  cursor: pointer;
  transition: all 0.2s;
}

.post-tag:hover {
  background: #bbdefb !important;
}
</style>
{{ end }}
