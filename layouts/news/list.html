<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "en-us" }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>News | {{ .Site.Title }}</title>
  <meta name="description" content="{{ .Site.Params.description | default .Site.Title }}">
  {{ range .Site.Params.custom_css }}
  <link rel="stylesheet" href="/{{ . }}">
  {{ end }}
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", sans-serif; line-height: 1.7; color: #1a2a28; padding-top: 80px; }
    a { color: #3d7a6f; text-decoration: none; }
    a:hover { color: #2d5a4f; }
  </style>
</head>
<body>
  {{ partial "site-header.html" . }}

  <main>
<div style="max-width: 72rem; margin: 0 auto; padding: 2rem 1rem;">
  <section style="padding: 0;">

    <!-- Category Filter Section -->
    <div id="category-filter-section" style="margin-bottom: 2rem; padding: 2rem; background: #f7f9f8; border-radius: 12px; border: 1px solid #e0e8e6;">
      <h3 style="margin: 0 0 1.25rem 0; color: #2d5a4f; font-size: 1.1rem; font-weight: 700;">Filter by News Category:</h3>

      <div id="category-buttons" style="display: flex; flex-wrap: wrap; gap: 0.75rem;">
        <button onclick="filterPosts('all', 'category')" class="category-filter active" data-category="all"
                style="padding: 0.6rem 1.2rem; border: 1px solid #3d7a6f; background: #3d7a6f; color: white; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; font-weight: 500;">
          All Categories
        </button>

        {{ $allCategories := slice }}
        {{ range .Pages }}
          {{ if .Params.category }}
            {{ $allCategories = $allCategories | append .Params.category }}
          {{ end }}
        {{ end }}
        {{ $uniqueCategories := $allCategories | uniq | sort }}

        {{ range $uniqueCategories }}
        <button onclick="filterPosts('{{ . }}', 'category')" class="category-filter" data-category="{{ . }}"
                style="padding: 0.6rem 1.2rem; border: 1px solid #3d7a6f; background: white; color: #3d7a6f; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; font-weight: 500;">
          {{ . }}
        </button>
        {{ end }}
      </div>
    </div>

    <!-- Company Type Filter Section -->
    <div id="company-type-filter-section" style="margin-bottom: 2.5rem; padding: 2rem; background: #f7f9f8; border-radius: 12px; border: 1px solid #e0e8e6;">
      <h3 style="margin: 0 0 1.25rem 0; color: #2d5a4f; font-size: 1.1rem; font-weight: 700;">Filter by Company Type:</h3>

      <div id="company-type-buttons" style="display: flex; flex-wrap: wrap; gap: 0.75rem;">
        <button onclick="filterPosts('all', 'company_type')" class="company-type-filter active" data-company_type="all"
                style="padding: 0.6rem 1.2rem; border: 1px solid #d4a574; background: #d4a574; color: white; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; font-weight: 500;">
          All Types
        </button>

        {{ $allCompanyTypes := slice }}
        {{ range .Pages }}
          {{ if .Params.company_type }}
            {{ $companyType := .Params.company_type }}
            {{ if eq (printf "%T" $companyType) "string" }}
              {{ if ne $companyType "Bioplastic Producer, Technology Company" }}
                {{ $allCompanyTypes = $allCompanyTypes | append $companyType }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
        {{ $uniqueCompanyTypes := $allCompanyTypes | uniq | sort }}

        {{ range $uniqueCompanyTypes }}
        <button onclick="filterPosts('{{ . }}', 'company_type')" class="company-type-filter" data-company_type="{{ . }}"
                style="padding: 0.6rem 1.2rem; border: 1px solid #d4a574; background: white; color: #d4a574; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; font-weight: 500;">
          {{ . }}
        </button>
        {{ end }}
      </div>

      <div id="active-filters" style="font-size: 0.9rem; color: #6b7f7d; margin-top: 1.25rem; font-weight: 500;">
        Showing: <span id="filter-status" style="color: #2d5a4f;">All posts</span>
      </div>
    </div>

    <!-- Posts Counter -->
    <div id="posts-counter" style="margin-bottom: 2rem; padding: 0.75rem 0; color: #6b7f7d; font-size: 0.95rem; border-bottom: 1px solid #e0e8e6;">
      <span id="visible-count" style="font-weight: 600; color: #2d5a4f;">{{ len .Pages }}</span> of <span style="font-weight: 600; color: #2d5a4f;">{{ len .Pages }}</span> posts
    </div>

    <!-- News List Grid -->
    <div class="news-list" id="news-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2.5rem;">
      {{ range .Pages.ByDate.Reverse }}
      <article class="news-post" data-tags="{{ if .Params.tags }}{{ delimit .Params.tags "," }}{{ end }}" data-category="{{ .Params.category }}" data-company_type="{{ .Params.company_type }}"
               style="background: white; border: 1px solid #e0e8e6; border-radius: 12px; overflow: hidden; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(26, 42, 40, 0.06); display: flex; flex-direction: column;">

        {{ if .Params.featured_image }}
        <div style="width: 100%; height: 200px; overflow: hidden; background: #f7f9f8;">
          <img src="{{ .Params.featured_image }}" alt="{{ .Title }}" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
        </div>
        {{ end }}

        <div style="padding: 1.75rem; flex-grow: 1; display: flex; flex-direction: column;">
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; font-size: 0.85rem;">
            <time datetime="{{ .Date.Format "2006-01-02" }}" style="color: #6b7f7d; font-weight: 500;">
              {{ .Date.Format "Jan 2, 2006" }}
            </time>
            {{ if .Params.category }}
            <span style="background: #e8f2f0; color: #2d5a4f; padding: 0.3rem 0.7rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
              {{ .Params.category }}
            </span>
            {{ end }}
          </div>

          <h2 style="font-size: 1.35rem; color: #2d5a4f; line-height: 1.3; margin-bottom: 0.75rem; font-weight: 700; letter-spacing: -0.5px;">
            <a href="{{ .Permalink }}" style="color: inherit; text-decoration: none; transition: color 0.3s;">{{ .Title }}</a>
          </h2>

          {{ if .Params.tags }}
          <div class="post-tags" style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;">
            {{ range .Params.tags }}
            <span class="post-tag" style="background: #e8f2f0; color: #3d7a6f; padding: 0.25rem 0.6rem; border-radius: 6px; font-size: 0.75rem; font-weight: 500;">
              {{ . | title }}
            </span>
            {{ end }}
          </div>
          {{ end }}

          <p style="color: #6b7f7d; font-size: 0.95rem; line-height: 1.7; margin-bottom: 1.25rem; flex-grow: 1;">
            {{ .Summary }}
          </p>

          <div style="display: flex; justify-content: flex-end; align-items: center; padding-top: 1rem; border-top: 1px solid #e0e8e6;">
            <a href="{{ .Permalink }}" style="color: #3d7a6f; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.3s; text-decoration: none;">
              Read more â†’
            </a>
          </div>
        </div>
      </article>
      {{ end }}
    </div>

    <!-- No Results Message -->
    <div id="no-results" style="display: none; text-align: center; padding: 3rem 0; color: #6b7f7d; font-style: italic;">
      <h3 style="margin-bottom: 1rem; color: #2d5a4f; font-weight: 600;">No posts found</h3>
      <p>Try selecting different filters or view all posts.</p>
    </div>

  </section>
</div>

<script>
let currentCategoryFilter = 'all';
let currentCompanyTypeFilter = 'all';

function filterPosts(value, filterType) {
  // Update filter state
  if (filterType === 'category') {
    currentCategoryFilter = value;
  } else if (filterType === 'company_type') {
    currentCompanyTypeFilter = value;
  }

  const posts = document.querySelectorAll('.news-post');
  const noResults = document.getElementById('no-results');
  const filterStatus = document.getElementById('filter-status');
  const visibleCount = document.getElementById('visible-count');
  let visiblePosts = 0;

  // Update active buttons for categories
  document.querySelectorAll('.category-filter').forEach(btn => {
    btn.classList.remove('active');
    btn.style.background = 'white';
    btn.style.color = '#3d7a6f';
  });

  const activeCategoryBtn = document.querySelector(`[data-category="${currentCategoryFilter}"]`);
  if (activeCategoryBtn) {
    activeCategoryBtn.classList.add('active');
    activeCategoryBtn.style.background = '#3d7a6f';
    activeCategoryBtn.style.color = 'white';
  }

  // Update active buttons for company types
  document.querySelectorAll('.company-type-filter').forEach(btn => {
    btn.classList.remove('active');
    btn.style.background = 'white';
    btn.style.color = '#d4a574';
  });

  const activeCompanyTypeBtn = document.querySelector(`[data-company_type="${currentCompanyTypeFilter}"]`);
  if (activeCompanyTypeBtn) {
    activeCompanyTypeBtn.classList.add('active');
    activeCompanyTypeBtn.style.background = '#d4a574';
    activeCompanyTypeBtn.style.color = 'white';
  }

  // Filter posts with AND logic - must match BOTH category and company_type
  posts.forEach(post => {
    const postCategory = post.getAttribute('data-category');
    const postCompanyType = post.getAttribute('data-company_type');

    const categoryMatches = currentCategoryFilter === 'all' || postCategory === currentCategoryFilter;
    const companyTypeMatches = currentCompanyTypeFilter === 'all' || postCompanyType === currentCompanyTypeFilter;

    const shouldShow = categoryMatches && companyTypeMatches;

    if (shouldShow) {
      post.style.display = 'flex';
      post.style.opacity = '1';
      visiblePosts++;
    } else {
      post.style.display = 'none';
      post.style.opacity = '0';
    }
  });

  // Update counter and status
  visibleCount.textContent = visiblePosts;

  let statusText = [];
  if (currentCategoryFilter !== 'all') {
    statusText.push(`"${currentCategoryFilter}"`);
  }
  if (currentCompanyTypeFilter !== 'all') {
    statusText.push(`"${currentCompanyTypeFilter}"`);
  }

  if (statusText.length === 0) {
    filterStatus.textContent = 'All posts';
  } else {
    filterStatus.textContent = statusText.join(' + ');
  }

  // Show/hide no results message
  if (visiblePosts === 0) {
    noResults.style.display = 'block';
  } else {
    noResults.style.display = 'none';
  }
}

// Add hover effects to buttons
document.addEventListener('DOMContentLoaded', function() {
  const categoryButtons = document.querySelectorAll('.category-filter');
  const companyTypeButtons = document.querySelectorAll('.company-type-filter');

  [categoryButtons, companyTypeButtons].forEach(buttonGroup => {
    buttonGroup.forEach(btn => {
      btn.addEventListener('mouseenter', function() {
        if (!this.classList.contains('active')) {
          this.style.opacity = '0.8';
        }
      });

      btn.addEventListener('mouseleave', function() {
        if (!this.classList.contains('active')) {
          this.style.opacity = '1';
        }
      });
    });
  });

  // Add hover effects to news cards
  document.querySelectorAll('.news-post').forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-6px)';
      this.style.boxShadow = '0 12px 24px rgba(26, 42, 40, 0.12)';
      this.style.borderColor = '#3d7a6f';
    });
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 2px 8px rgba(26, 42, 40, 0.06)';
      this.style.borderColor = '#e0e8e6';
    });
  });
});
</script>

<style>
.category-filter, .company-type-filter {
  transition: all 0.2s ease;
}

.category-filter:hover, .company-type-filter:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(26, 42, 40, 0.1);
}

.category-filter.active {
  background: #3d7a6f !important;
  color: white !important;
}

.company-type-filter.active {
  background: #d4a574 !important;
  color: white !important;
}

.news-post {
  transition: all 0.3s ease;
}

.news-post:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 24px rgba(26, 42, 40, 0.12) !important;
  border-color: #3d7a6f !important;
}

.news-post:hover img {
  transform: scale(1.05);
}

.post-tag {
  cursor: pointer;
  transition: all 0.2s;
}

.post-tag:hover {
  background: #d4e8e5 !important;
}

@media (max-width: 768px) {
  #news-list {
    grid-template-columns: 1fr !important;
  }
}
</style>

  </main>

  {{ partial "site-footer.html" . }}
</body>
</html>
